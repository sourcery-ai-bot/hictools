/************************************************default params***************************************/

params {
    default_config = true
    stat = true
    fastqc = true

    map.assembly = "unknown"
    map.genome = ""
    map.chunksize = 400000
    map.merge_bam = true
    
    parse.parse_arags = "--min-mapq 0 --drop-sam --drop-seq --drop-readid" 
    parse.sort_tmpdir = "/tmp"
    
    filter.frag_path = ""
    filter.enzyme = ""
    filter.filter_expr = "((pair_type=='UU') or (pair_type=='UR') or (pair_type=='RU'))"
    
    resolutions = [10000, 100000, 1000000] 
}

/**********************************************nexflow setting***************************************/
profiles {
    standard {
        executor {
            queueSize = 40
        }
        process {
            executor = 'local'
            scratch = true
            cache = true
            withName: map_parse_sort {
                maxForks = 15
            }
            withName: split_fastq_chunks {
                maxForks = 25
            }
        }
    }
    cluster {
        params.ratio = 2.0
        executor {
            queueSize = 100
            queueStatInterval = "10 sec"
        }
        process {
            executor = 'sge'
            scratch = false
            cache = true
            penv = "mpi"
            queue = "all.q"
            withName: map_parse_sort {
                maxForks = 80
            }
            withName: split_fastq_chunks {
                maxForks = 10
            }
        }
    }
}

process {
    errorStrategy = { 'retry' }
    maxRetries = 0
    cpus = {1 * task.attempt}
    memory = {500.MB* task.attempt}
    cache = "lenient"
    conda = "$baseDir/environment.yml"
    
    withName: digest {
        memory = "2 GB"
    }
    withName: fastq_dump {
        cpus = 10
        memory = "2 GB"
    }
    withName: fastqc {
        cpus = 5
        memory = "2 GB"
    }
    withName: split_fastq_chunks {
        cpus = 2
    }
    withName: map_parse_sort {
        cpus = 5
        memory = "10 GB"
    }
    withName: merge_bam {
        cpus = 8
        memory = "2 GB"
    }
    withName: merge_pair {
        cpus = 5
        memory = "15 GB"
    }
    withName: merge_exp_dedup {
        cpus = 3
        memory = "10 GB"
    }
    withName: merge_bio {
        cpus = 3
        memory = "10 GB"
    }
    withName: pair_to_cool {
        memory = "4 GB"
    }
    withName: zoomify_cool {
        memory = "1 GB"
    }
    withName: mcool_to_features {
        cpus = 20
        memory = "20 GB"
    }
}

docker {
    enabled = true
    remove = true
    temp = 'auto'
}

conda {
    cacheDir = "$HOME/.nextflowenv"
}

trace {
    enabled = true
    fields = "name,hash,native_id,status,exit,disk,start,complete,duration,%cpu,%mem,rchar,wchar"
    file = "log/trace.log"
}

timeline {
    enabled = true
    file = "log/timeline.html"
}

report {
    enabled = true
    file = "log/report.html"
}

manifest {
    homePage = 'http://www.123.com'
    description = 'Hic processing pipeline'
    mainScript = 'main.nf'
    version = '1.0.0'
}
